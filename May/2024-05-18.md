# TIL

## ë‚ ì§œ: 2024-05-18

ì˜¤ëŠ˜ í•œ ì¼ : ê³¼ì œ 3ì£¼ì°¨ ì™„ë£Œ + íšŒê³  ì‘ì„±ê¹Œì§€.

#### ì£¼ì œ 1: CORS ì„¤ì • ì½”ë“œ

##### ğŸ”† CORSë€ ë¬´ì—‡ì¸ê°€?

CORS(Cross-Origin Resource Sharing)ëŠ” ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ë‹¤ë¥¸ ë„ë©”ì¸ì— ìˆëŠ” ë¦¬ì†ŒìŠ¤ì— ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ í—ˆìš©í•˜ëŠ” ë³´ì•ˆ ê¸°ëŠ¥ì…ë‹ˆë‹¤. ë¸Œë¼ìš°ì € ë³´ì•ˆ ì •ì±…ì— ë”°ë¼ ë‹¤ë¥¸ ì¶œì²˜ì˜ ë¦¬ì†ŒìŠ¤ì— ì ‘ê·¼í•˜ëŠ” ê²ƒì€ ê¸°ë³¸ì ìœ¼ë¡œ ì œí•œë˜ì–´ ìˆìœ¼ë©°, ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ì„œë²„ì—ì„œ íŠ¹ì • ì„¤ì •ì„ í†µí•´ ì´ëŸ¬í•œ ì ‘ê·¼ì„ í—ˆìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```jsx
app.use(
  cors({
    origin: "http://localhost:3000", // í´ë¼ì´ì–¸íŠ¸ ì£¼ì†Œ
    credentials: true, // ìê²© ì¦ëª…ê³¼ í•¨ê»˜ ìš”ì²­ í—ˆìš©
    methods: ["GET", "POST", "PUT", "DELETE"], // í—ˆìš©í•  HTTP ë©”ì†Œë“œ
    allowedHeaders: ["Content-Type", "Authorization"], // í—ˆìš©í•  í—¤ë”
  })
);
```

> CORS ì„¤ì •ì˜ ì˜ë¯¸ì™€ ì‚¬ìš© ì´ìœ 

- `origin: "http://localhost:3000"`

  - ì´ ì„¤ì •ì€ http://localhost:3000ì—ì„œ ì˜¤ëŠ” ìš”ì²­ì„ í—ˆìš©í•©ë‹ˆë‹¤. ì¦‰, í”„ë¡ íŠ¸ì—”ë“œ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì´ ì£¼ì†Œì—ì„œ í˜¸ìŠ¤íŒ…ë˜ê³  ìˆë‹¤ê³  ê°€ì •í•©ë‹ˆë‹¤.

- `credentials: true`

  - ì´ ì„¤ì •ì€ ìê²© ì¦ëª…(ì¿ í‚¤, ì¸ì¦ í—¤ë” ë“±)ì„ í¬í•¨í•œ ìš”ì²­ì„ í—ˆìš©í•©ë‹ˆë‹¤. ì´ëŠ” í´ë¼ì´ì–¸íŠ¸ì™€ ì„œë²„ ê°„ì˜ ì„¸ì…˜ ê´€ë¦¬ê°€ í•„ìš”í•œ ê²½ìš° ìœ ìš©í•©ë‹ˆë‹¤.

- `methods: ["GET", "POST", "PUT", "DELETE"]`

  - ì´ ì„¤ì •ì€ í—ˆìš©í•  HTTP ë©”ì†Œë“œë¥¼ ì§€ì •í•©ë‹ˆë‹¤. ì—¬ê¸°ì„œëŠ” GET, POST, PUT, DELETE ë©”ì†Œë“œê°€ í—ˆìš©ë©ë‹ˆë‹¤.

- `allowedHeaders: ["Content-Type", "Authorization"]`

  - ì´ ì„¤ì •ì€ í´ë¼ì´ì–¸íŠ¸ê°€ ìš”ì²­ ì‹œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” í—¤ë”ë¥¼ ì§€ì •í•©ë‹ˆë‹¤. ì—¬ê¸°ì„œëŠ” Content-Typeê³¼ Authorization í—¤ë”ê°€ í—ˆìš©ë©ë‹ˆë‹¤.

> ì™œ ì‚¬ìš©í•˜ëŠ”ê°€?

- ë³´ì•ˆ ê°•í™”
  - ê¸°ë³¸ì ìœ¼ë¡œ ë¸Œë¼ìš°ì €ëŠ” ë‹¤ë¥¸ ì¶œì²˜ì—ì„œì˜ ë¦¬ì†ŒìŠ¤ ìš”ì²­ì„ ì°¨ë‹¨í•©ë‹ˆë‹¤. CORSë¥¼ í†µí•´ í•„ìš”í•œ ì¶œì²˜ì— ëŒ€í•´ì„œë§Œ ì ‘ê·¼ì„ í—ˆìš©í•¨ìœ¼ë¡œì¨ ë³´ì•ˆì„ ê°•í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- ìœ ì—°í•œ í´ë¼ì´ì–¸íŠ¸-ì„œë²„ í†µì‹ 
  - í´ë¼ì´ì–¸íŠ¸(í”„ë¡ íŠ¸ì—”ë“œ)ì™€ ì„œë²„(ë°±ì—”ë“œ)ê°€ ë‹¤ë¥¸ ë„ë©”ì¸ì— ìˆì„ ë•Œ, CORS ì„¤ì •ì„ í†µí•´ ë‘ ë„ë©”ì¸ ê°„ì˜ ìì› ê³µìœ ë¥¼ í—ˆìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŠ” ê°œë°œ í™˜ê²½ì—ì„œ í”„ë¡ íŠ¸ì—”ë“œì™€ ë°±ì—”ë“œê°€ ë‹¤ë¥¸ ì„œë²„ì—ì„œ ì‹¤í–‰ë  ë•Œ íŠ¹íˆ ìœ ìš©í•©ë‹ˆë‹¤.

> CORS ì„¤ì •ì´ ì¢‹ì€ ì 

- ë³´ì•ˆ ê´€ë¦¬: í•„ìš”í•œ ì¶œì²˜ì— ëŒ€í•´ì„œë§Œ ì ‘ê·¼ì„ í—ˆìš©í•˜ì—¬ ë³´ì•ˆì„ ìœ ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- ì„¸ì…˜ ê´€ë¦¬: ìê²© ì¦ëª…ì„ í¬í•¨í•œ ìš”ì²­ì„ í—ˆìš©í•¨ìœ¼ë¡œì¨, í´ë¼ì´ì–¸íŠ¸ì™€ ì„œë²„ ê°„ì˜ ì„¸ì…˜ ê´€ë¦¬ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.
- ê°œë°œ í¸ì˜ì„±: ê°œë°œ í™˜ê²½ì—ì„œ í”„ë¡ íŠ¸ì—”ë“œì™€ ë°±ì—”ë“œë¥¼ ë¶„ë¦¬í•˜ì—¬ ê°œë°œí•  ìˆ˜ ìˆê²Œ ë„ì™€ì¤ë‹ˆë‹¤.

### ì˜¤ëŠ˜ì˜ ë„ì „ ê³¼ì œì™€ í•´ê²° ë°©ë²•

- ë„ì „ ê³¼ì œ 1: íšŒì›ì •ë³´ ë³€ê²½ í›„ ì¬ë¡œê·¸ì¸ì„ í•˜ì§€ ì•Šê³  ê²Œì‹œê¸€/ëŒ“ê¸€ì„ ì‘ì„±í•˜ë©´ ë³€ê²½ ì „ ë‹‰ë„¤ì„, í”„ë¡œí•„ ì‚¬ì§„ìœ¼ë¡œ ë“±ë¡ì´ ë˜ëŠ” ë¬¸ì œ
  - í•´ê²°ë°©ë²• : íšŒì›ì •ë³´ ìˆ˜ì • Postìš”ì²­ ì²˜ë¦¬ ì½”ë“œì—ì„œ, ì •ë³´ìˆ˜ì •ì™„ë£Œ ì‹œ, ì„¸ì…˜ì˜ ê°’ì„ ë³€ê²½ê°’ìœ¼ë¡œ ì—…ë°ì´íŠ¸ í•´ì£¼ëŠ” ì½”ë“œë¥¼ ì¶”ê°€í•˜ì—¬ í•´ê²°.
  ```jsx
  fs.writeFile(fileUsersPath, JSON.stringify(users, null, 2), (err) => {
    if (err) {
      return res.status(500).json({ message: "ë‹‰ë„¤ì„ ìˆ˜ì • ì‹¤íŒ¨" });
    }
    // ì„¸ì…˜ ì •ë³´ ì—…ë°ì´íŠ¸
    req.session.user.nickname = nickname;
    req.session.user.profileImg = newProfileImagePath;
    return res.status(201).json({ message: "ë‹‰ë„¤ì„ ìˆ˜ì • ì„±ê³µ" });
  });
  ```
- ë„ì „ ê³¼ì œ 2: ë„ì „ ê³¼ì œì— ëŒ€í•œ ì„¤ëª… ë° í•´ê²° ë°©ë²•

### ë¸”ë¡œê·¸, ë…¸ì…˜, ê¹ƒ ì •ë¦¬ ë§í¬

- [CORS, wiresharkì‹¤ìŠµ, HTTP ë³´ì•ˆí—¤ë” ì •ë¦¬](https://goorm.notion.site/565207b64f794914b91bb357c41cf99a?pvs=4)
- [3ì£¼ì°¨ ê³¼ì œ íšŒê³ ](https://goorm.notion.site/3-dce9557513494264b51d7f5296e27162?pvs=4)
